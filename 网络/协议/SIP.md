

# SIP


## 总体

### 概述
* 会话初始协议，一个多媒体通信协议
* 基于文本的应用层控制协议，管理多个参与者的会话


### 事务
* SIP是一种事务型协议，事务建立在请求和回复之上


![](http://picbed.cc12703.com/20221021130814.png)


### 角色

#### 用户代理（UA）
* User Agent： 一种用户实体
* 分为：用户端代理（UAC）, 服务端代理（UAS）

#### 代理服务器（PS）
* Proxy Server：用于转发请求和回复
* 分为：有状态、无状态

#### 注册定位服务器（RLS）
* Registration/Location Server：用于登记和定位UA

#### 重定向服务器（RS）
* Redirect Server：用于重定向，相当于一个特殊功能的UA


## 方法

### 核心方法
* `INVITE`： 发起一个新的会话
* `ACK`：确认一个会话已建立
* `BYE`：结束一个会话
* `CANCEL`：取消一个请求，大部分情况指INVITE
* `OPTIONS`：查询服务器能力
* `REGISTER`：客户端注册


### 扩展方法
* `NOTIFY`：通知用户事件
* `PUBLISH`：发送事件到服务器
* `INFO`：在会话中发送消息
* `MESSAGE`：发送即时消息


## 格式

### 概述
* 三个部分：起始/状态行、SIP头、消息体


### 状态码
* `1xx`：临时响应，消息正在处理
* `2xx`：成功响应
* `3xx`：重定向响应
* `4xx`：客户端错误
* `5xx`：服务器错误
* `6xx`：全局故障，任何服务器都无法完成请求


### SIP头
* 通用头域
* 请求头域
* 响应头域
* 实体头域


### 请求消息

![](http://picbed.cc12703.com/20221021133658.png)



### 响应消息

![](http://picbed.cc12703.com/20221021133721.png)




## SDP

### 概述
* 描述会话协议，用于实体之间的媒体协商
* 由多个文本行组成，每行格式为`<类型>=<值>`

### 信息
* 会话信息
* 媒体信息：类型、传输协议、格式、传输端口


### 格式
* 一个会话级描述 和 多个媒体级描述
* 会话级描述从`v=xxx`开始
* 媒体级描述从`m=xxx`开始