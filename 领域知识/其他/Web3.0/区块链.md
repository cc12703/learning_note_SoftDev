
# 区块链


## 概述

### 核心模块
* P2P网络协议 
* 分布式一致性算法（共识机制）
* 加密签名算法
* 账户与交易模型




## P2P网络协议

### 概述
* 系统的最底层模块
* 负责数据传输、广播、节点发现、维护

### 要点

#### 拓扑结构
* 中心化
* 半中心化
* 全分布式

#### 节点发现
* 初始节点发现：首次运行，无任何节点数据
* 启动后节点发现：跟随网络动态维护可用节点

#### 局域网穿透
* NAT技术
* UPnP技术


## 共识机制

### 概述
* 区块链的核心模块
* 决定了业务的吞吐量、交易速度、不可篡改性
* 特点：融入了经济学的博弈概念
* 思路：让攻击者的攻击成本远远大于收益

### 常用算法
* PoW：工作量证明算法
* PoS：权益证明算法
* DPoS：代理权益证明算法


### PoW（Proof of Work）

#### 概述
* 设计思路：提出一个计算难题，但是答案的验证过程非常简单
* 比特币中：用SHA256计算一个目标哈希，使得该哈希值符合前N位全是0
* 理解：将现实世界的物料资源转化成区块链上虚拟资源的过程

#### 原理
* 公式：`Hash(block_header) < Target`

#### 分类
* 计算困难：出现了专业的挖矿芯片
* 内存困难：没有出现专业的挖矿芯片

#### 优点
* 可以稳定币价
* 工业成熟度最高的区块共识算法

#### 缺点
* 非常消耗计算资源，耗电耗能源
* 面临挖矿中心化严重的问题

### PoS（Proof of Stake）

#### 概述
* 节点的币龄越多，获得记账的概率就越大
	* 币龄：币数量乘以天数

#### 原理
* 公式：`Hash(block_header) < Target * CoinAge`

#### 问题
* 币发行问题：开始时只有创世区块有币，需要让币分散出去
* 币龄于时间挂钩：用户可以无限囤积币
* 用户会倾向于囤积代币，造成币流通的不充分
* 离线攻击：因为时间是自然流动的，所以挖矿是可以离线的
* 无成本利益问题：挖矿几乎没有成本，意味着分叉非常方便


### DPoS（Delegated Proof of Stake）

#### 概述
* 将PoS中的记账者转换为指定节点组成的小圈子
* 投票选举：让全网所有节点投票决定哪些节点可以成为记账节点

#### 特点
* 带中心化思路的共识机制


## 账户与交易模型

### 类型
* UTXO结构
* Account-Balance结构

### Account-Balance
* 普通账户模型
* 账户会记录当前余额

### UTXO
* 未花费的交易输出
* 思路：记录交易事件，不记录最终状态
* 用户余额需要根据历史记录计算出来




## 智能合约

### 概述
* 指可以“自治自理”的计算机协议，该协议具有自我执行，自我验证的属性