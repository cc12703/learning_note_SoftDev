

# 概述



## 术语

### 带宽
* 单位：`bits/s`或`bps` 单位时间内的比特数
* 含义：数据的发送速度
	* 例子：百兆网卡指网卡的最大发送速度为`100Mbps`

#### 限制带宽
* 原因：带宽是有限的
* 方法：限制交换机对于你主机数据的接收速度
	* 原因：数据链路层的流量控制是通过控制接收方来实现的，接收方的接收能力


### 下载速度
* 单位：`Bytes/s` 单位时间内的字节数
* 含义：单位时间从服务器到达用户PC的数据量的多少
* 计算公式：下载速度 = 数据量字节数 / 响应时间


### 响应时间
* 含义：数据从服务器发送直到完全到达用户PC的这段时间
* 构成：响应时间 = 发送时间 + 传播时间 + 处理时间
* 计算公式：
	* 发送时间 = 数据量比特数 / 带宽
	* 传播时间 = 传播距离 / 传播速度
	* 处理时间 = 数据在交换节点队列中的排队时间


### 吞吐率
* 单位：`reqs/s` 单位时间内服务器处理的请求数
* 作用：描述Web服务器的并发能力
* 估算方法：压力测试

### 压力测试

#### 压力描述
* 并发用户数：在某一时刻**同时**向服务器发送请求的用户总数
* 总请求数

#### 请求等待时间
* 用户平均请求等待时间
	* 作用：衡量服务器在一定并发用户下，对于单个用户的服务质量
* 服务器平均请求处理时间
	* 作用：衡量服务器在一定并发用户下，服务器的整体服务质量


## 思维
* 构建可靠系统的观念：从**追求尽量不出错**到**出错是必然**


## 架构种类

### 单体
* 单体也是有设计的
	* 使用分层架构进行纵向拆分
	* 使用模块进行横向拆分
* 缺陷：在拆分后的自治与隔离能力上
* 架构图
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211023152341.png)


### 微内核(插件式)
* 将主数据、公共服务、资源集中到一起，构成系统的核心
* 具体的业务系统以插件模块的形式存在
* 架构图
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211023154849.png)


### 事件驱动
* 在子系统之间建立一个事件队列
* 子系统从队列中获取要处理的事件，并发送事件到队列中
* 系统外部的消息会以事件的方式发送到队列中
* 架构图
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211023160059.png)


### 微服务
* 通过多个小型服务组合来构建单个应用
* 服务之间使用轻量级的通信机制
* 使用自动化部署来进行运维
* 最大价值：可靠系统完全可能由会出错的服务组成

#### 核心特征
* 围绕业务能力进行构建（康威定律）
	* 有怎样的团队（结构、规模、能力）就会产生对应的产品
* 分散治理
	* 服务对应的开发团队，直接负责运维
* 通过服务来实现独立自治的组件
	* 这会给组件带来自治和隔离能力
* 产品化思维
	* 团队要为软件产品的整个生命周期负责
* 数据去中心化
	* 提倡数据应该按领域分散管理、更新、维护、存储
* 强终端弱管道
	* 提倡简单直接的通信方式
* 容错性设计
	* 承认服务总会出错，需要应对出错
* 演进式设计
	* 承认服务会被报废淘汰
* 基础设施自动化




## 应用发展过程

### 阶段1
* 应用程序、数据库、文件等所有资源都运行在一台服务器上

### 阶段2
* 应用服务和数据服务分离
* 应用程序、数据库、文件运作在三台服务器上

### 阶段3
* 使用缓存改善性能
* 类型：应用服务器上的本地缓存、分布式缓存服务器

### 阶段4
* 使用应用服务器集群改善并发能力
* 通过负载均衡器，分发用户请求

### 阶段5
* 数据库读写分离
* 形式：主从数据库
	1. 写数据时，访问主数据库
	1. 主数据库通过主从复制将数据同步到从数据库
	1. 读数据时，访问从数据库

### 阶段6
* 使用反向代理、CDN加速响应
* 基本原理都是缓存数据



## 多级分流

### 原则
* 尽可能减少单点部件，如果无可避免则最大限度的减少到达该部件的流量
* 最简单的系统就是最好的系统


### 客户端缓存

#### 原理
* 基于HTTP协议
* 服务器在响应中附加一些条件
* 客户端在遇到相同请求时，会先判断条件是否满足
* 若条件满足，则直接使用上次的响应


## 域名解析

### 流程
