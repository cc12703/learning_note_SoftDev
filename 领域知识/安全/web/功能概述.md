

# 功能概述

[TOC]

## 类别

* **认证**：如何正确分辩出用户的真实身份
* **授权**：如何控制用户该看到哪些数据、操作哪些功能
* **凭证**：如何保证与用户之间的承若是双方真实意图的体现
* **保密**：如何保证敏感数据无法被**内外人员**窃取
* **传输**：如何保证通过网络传输的信息无法被第三方窃听、篡改
* **验证**：如何保证提交到每项服务的数据是合乎规则的



## 认证

### 类别
* 基于信道上的认证：在建立通信连接前进行认证
* 基于协议上的认证：在获取资源前进行认证
* 基于内容上的认证：在使用提供的服务前进行认证

### 规范

#### J2EE
* Client-Cert
* HTTP Basic认证
* HTTP 摘要认证
* 表单认证

##### HTTP认证框架
* 目的：将认证的目的(要产生身份凭证)和实现(如何产生凭证)分离开来
* 基本流程：
	1. 未授权用户访问服务时，服务器返回401，并携带响应头（告知客户端如何产生凭证）
	1. 客户端遵循服务器指定的认证方案，生成凭证信息并发送给服务器
	1. 服务器核实通过返回200，核实不通过返回403


#### WebAuthn

##### 特点
* 包含“注册”和“认证”流程
* 直接使用生物识别或实体密钥来进行身份认证
* 使用公钥、私钥代替了传统的密码

##### 注册流程
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211020164506.png)

要点：
1. Challenge为一个随机字符串
1. 验证器返回一个密钥对，私钥存储在验证器中
1. 验证器会使用私钥对Challenge进行签名
1. 服务器使用公钥对Challenge进行解密，并与发送前的进行比较

##### 认证流程
1. 用户输入用户名，点击“登录”
1. 服务器返回Challenge和UserID
1. 验证器提示用户进行认证操作，使用存储的该域名的私钥加密Challenge
1. 服务器使用注册时存储的公钥解密Challenge，解密成功即为登录成功


### 实现
* Apache Shiro
* Spring Security




## 授权

### 功能
* 确保授权过程的可靠
	* 让第三方访问到所需要的资源，而不泄漏用户的敏感数据
* 确保授权出的结果有效果（使用访问控制）
	* 使用结果控制程序的功能或者资源的访问
	

### 访问控制
* 实质：**谁**拥有什么**权限**去**操作**哪些**资源**
* 目的：管理垂直权限和水平权限
	* 垂直权限：功能权限，对完成某项操作的许可
	* 水平权限：数据权限

### 方案

#### RBAC
* 基于角色的访问控制(Role-Based Access Control)

##### 关系
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211020171944.png)

要点：
1. 角色：解耦用户与权限之间的多对多关系
1. 许可：解耦操作与资源之间的多对多关系


#### OAuth2
* 使用令牌代替用户密码作为授权的凭证

##### 总体流程
![](https://gitee.com/cc12703/figurebed/raw/master/img/20211020173321.png)

##### 方式
* 授权码模式
* 隐式授权模式
* 密码模式
* 客户端模式



## 凭证

### 功能
* 用于承载认证授权的信息


### 方案

#### Cookie-Session

##### 概述
* HTTP协议定义Set-Cookie指令，来向客户端设置一组信息
* 一段时间内每次HTTP请求都会使用Cookie头携带上这组信息
* 状态信息会保存在服务端，Cookie中只传输一个无意义、不重复的字符串

##### 特点
* 完全避免信息在传输过程中被泄漏、篡改
* 服务端可以主动的修改、清除状态信息



#### JWT

##### 特点
* 只能处理认证授权问题
* 只能携带少量非敏感信息
* 只解决篡改问题，不解决泄漏问题（默认是不加密的）

##### 结构
* 令牌头：描述令牌类型和签名算法
* 负载：包含向服务端传递的信息
* 签名：用于确保负载中的信息是可信的、没有被篡改的



## 传输

