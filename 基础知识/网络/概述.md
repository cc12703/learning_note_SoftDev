

# 概述

[TOC]


## 整体

![](http://picbed.cc12703.com/20230120005742.png)



## 术语

* 交换：同网络访问
* 路由：跨网络访问




## 物理层（第一层）

### 功能
* 连接不同的设备
* 数据单位：`比特流`


### 设备

#### 集线器
* 工作在物理层，将接收到数据复制到其他端口上
* 第一层联通方案





## 数据链路层（第二层）

### 功能
* 数据单位：`帧`
* 主要协议：`以太网协议`



### 设备

#### 交换机
* 工作在第二层，根据目标MAC地址来转发数据
* 使用STP协议来解决环路问题



### 以太网协议

#### MAC地址
* 网卡的物理地址
* 是一个唯一标识，像身份证
* 作用：为了组网，保证不同网卡在同一网络中不会发生冲突




### 虚拟局域网（VLAN）
* 在第二层协议头中增加一个TAG数据，使用VLAN ID来组成局域网
* 交换机之间通过Trunk口进行互联

![](http://picbed.cc12703.com/20230120124827.png)





## 网络层（第三层）

* 定义了整个网络端到端的传输行为

### IP地址
* 网卡在网络世界的通讯地址，像门牌号
* 作用：定位功能
* IPv4地址被分成5类
    * A、B、C类都有固定划分的网络号和主机号

![](http://picbed.cc12703.com/20230120010501.png)





#### CIDR
* 无类型域间选路：统一将32位地址一份为二，前面是网络号，后面是主机号
* 例子：`10.100.122.2/24`  前24位为网络号，后8位为主机号
    * 广播地址：`10.100.122.255`
    * 子网掩码：`255.255.255.0`


#### 保留网段
* 专门划出来用于内部使用的
* 例子：
    `10.0.0.0 -- 10.255.255.255`
    `172.16.0.0 -- 172.31.255.255`
    `192.168.0.0 -- 192.168.255.255`


### ARP协议
* 作用：使用IP地址获取MAC地址
* 方法：发送一个广播包（包含IP地址），由IP拥有者应答



### ICMP协议
* 互联网控制报文协议
* 封装在IP数据包中

#### 报文
* 查询报文：用于主动探查，ping基于该报文实现
* 差错报文：用于异常报告，traceroute基于该报文来实现



### 路由器（网关）
* 工作在第三层，根据目标MAC地址和IP地址来转发数据

#### 类型
* 转发网关：转发是不改变IP地址
* NAT网关：转发是改变IP地址

#### 路由表
* 包含多条路由规则，来决定如何转发流量
* 规则包含：目的网络、出口设备、下一跳网关

#### 动态路由
* 本质：如何找到最短路径
* BGP协议，基于距离矢量算法

##### IGP协议
* 内部网关协议，也称为OSPF协议
* 链路状态算法，基于Dijkstra算法
* 主要用于数据中心内部，重点是找到最短路径

##### BGP协议
* 外网路由协议
* 路径矢量算法，基于Bellman-Ford算法



## 传输层（第四层）


### UDP

#### 格式

![](http://picbed.cc12703.com/20230120231709.png)

#### 场景
* 需要资源少，网络情况较好的内网
* 对于丢包不敏感的应用
* 可以广播的应用
* 需要处理速度快，时延低，可以容忍少量丢包



### TCP

#### 要解决的问题
* 顺序问题：给数据包编号
* 丢包问题：确认序号
* 连接维护：连接握手，连接挥手
* 流量控制：发送窗口
* 拥塞控制：控制发送速度


#### 格式

![](http://picbed.cc12703.com/20230120234109.png)


#### 三次握手
* 请求 -》应答 -》应答之应答

![](http://picbed.cc12703.com/20230120234945.png)


#### 四次挥手

![](http://picbed.cc12703.com/20230120235115.png)


## 应用层（第五层）

### DHCP
* 动态主机配置协议
* 作用：租用IP地址、使用PXE来安装操作系统
* BOOTP协议的增强版本

