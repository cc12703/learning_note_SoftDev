

# DNS系统

[TOC]

## 总体

* DNS ==> Domain Name System

### 概述
* 一个分布式数据库系统
* 实现主机名称和IP地址之间的映射


## 域名空间

### 结构
* 域名空间就像一颗倒过来的树
* 树根：根域名，用点号表示
* 下一级：顶级域名，包括：国家顶级域名、国际顶级域名、通用顶级域名
* 下一级：二级域名，由国家自行确定
* 下一级：三级域名、四级域名

### 示例
* 国家顶级域名：`.cn`,`.us`,`.uk`
* 国际顶级域名：`.int`
* 通用顶级域名：`.com`,`.net`,`.org`,`coop`,`.gov`
* 类别域名: `.com`,`.edu`,`.gov`
* 行政域名: `.bj`,`.sh`



## 域名

### 概述
* 域名是为了识别主机名、机构而定义的一种分层的名称
* 本质上是一种管理范围的划分


### 格式
* 级别最高的域是**根域**，依次为**顶级域**、**二级域**，**三级域**，**四级域**
* 不同等级的域名使用**点号**分隔，级别最低的在最左边，级别最高的在最右边
* 每一级域名由英文字母和数字组成，域名不区分大小写


### 示例
**www.tsinghua.edu.cn**
* cn： 顶级域名，代表中国
* edu：二级域名，代表教育机构
* tsinghua：三级域名，代表清华大学
* www：三级域名中的主机，提供web服务

#### 图示
![](http://picbed.cc12703.com/20210619235425.png)




## 域名服务器

### 概述
* 管理授权的单位称为**区域**
* 一个**区域**是DNS域名空间的一棵子树，可以单独管理

#### 图示
![](http://picbed.cc12703.com/20210626000251.png)



### 类型

#### 本地服务器
* 离客户端较近，也称为 默认域名服务器
* 通过递归的方式从其他服务器查询域名


#### 根服务器
* 用于管理顶级域，本身不进行域名解析
* 记录了相关域名服务器的IP地址

#### 授权服务器
* 用于互联网上的主机进行注册
* 主机的授权域名服务器就是本地域名服务器

#### 主服务器
* 完成域名解析工作
* 是该区域中数据的唯一来源
* 配置**辅助服务器**来分担主服务器的压力



### 解析过程
![](http://picbed.cc12703.com/20230130123123.png)


#### 示例
![](http://picbed.cc12703.com/20210626002430.png)



## 协议

### 类型
* 查询/响应协议：执行域名的查询
* 交换数据库记录的协议：执行主、辅服务器之间的数据同步


### 格式

#### 数据包格式
![](http://picbed.cc12703.com/20230130122840.png)

#### 消息格式
![](http://picbed.cc12703.com/20230130115848.png)

* DNS消息：固定长度头 + 多个可变长度的区段
* 事务ID：客户端设置，用于匹配响应和查询


### 资源记录

#### 类型
* 数据类型：传输DNS中存储的信息
	* RP类型：A, AAAA，NS，CNAME，TXT
* 查询类型：除了数据类型的值外，包括了额外的值
* 元类型：与特定DNS消息相关联的临时数据


#### RP类型
* A记录：IPv4地址
* AAAA记录：IPv6地址
* CNAME记录：将一个名称映射为另一个
* NS记录：提供授权服务器的名称
* TXT记录：提供各种信息