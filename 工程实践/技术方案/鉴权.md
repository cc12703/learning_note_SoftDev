

# 鉴权

* 参考资料：https://juejin.cn/post/7129298214959710244


## 概述

### 概念

* 认证（Identification）
    * 根据声明者所特有的识别信息，确认声明者的身份
* 授权（Authorization）
    * 资源所有者委派执行者，赋予执行者指定范围的资源操作权限，以便对资源的相关操作。
* 鉴权（Authentication）
    * 对于一个声明者所声明的身份权利，对其所声明的真实性进行鉴别确认的过程。
* 权限控制（Access Control）
    * 将可执行的操作定义为权限列表，然后判断操作是否允许/禁止

### 关系
认证、授权、鉴权和权限控制这四个环节是一个前后依次发生、上下游的关系


![](http://picbed.cc12703.com/20221112001505.png)





## HTTP基本鉴权

### 概述
* 客户端使用用户名和密码，来实现身份验证
* 用途：内部网络、对安全要求不是很高的网络


### 流程
![](http://picbed.cc12703.com/20221112002043.png)


### 优点
1. 简单，所有流行的浏览器都支持

### 缺点
1. 不安全：使用HTTP传输
1. 无法主动注销



## Session-Cookie鉴权

### 概述
* 利用客户端的Cookie和服务端的Session来实现认证
* 用途：中大型网站

### 流程
![](http://picbed.cc12703.com/20221112003333.png)


### 优点
1. Cookie简单易用
1. Session方便管理
1. 只需服务端操作


### 缺点
1. 依赖于Cookie
1. 不安全：Cookie暴露在浏览器中
1. Session增大了服务端的开销
1. 对移动端的支持性不友好




## Token鉴权

### 概述
* Token是一个令牌，客户端访问服务器时需要携带


### 流程
![](http://picbed.cc12703.com/20221112004721.png)


### 优点
1. 服务端无状态化、可扩展性好
1. 支持 APP 移动端设备
1. 安全性好
1. 支持跨程序调用


### 缺点
1. 需要前后端配合处理
1. 占用更多带宽
1. 有效期短：避免Token被盗用


### 刷新Token
* 访问Token：访问业务接口，有效期短，盗用风险小
* 刷新Token：用来获取访问Token，有效期较长

![](http://picbed.cc12703.com/20221112005724.png)



## JWT鉴权

### 概述
* 将用户信息组成JSON对象，加密后返回给客户端


### 流程
![](http://picbed.cc12703.com/20221112010757.png)


### 优点
1. 服务端无状态化、可扩展性好
1. JWT中可以存储常用信息，降低服务器查询数据库的次数


### 缺点
1. JWT默认是不加密
1. JWT在到期之前就会始终有效



## 单点登录(SSO)

### 概述
* 通过使用"中央授权服务（CAS）"来进行鉴权


### 流程
![](http://picbed.cc12703.com/20221112011554.png)


### 要点

#### 接口
1. /login：登录到中央授权服务
1. /logout：从中央授权服务中登出
1. /validate：验证用户是否登录中央授权服务
1. /serviceValidate：让各个Service验证用户是否登录中央授权服务

#### 票据
1. TGT：CAS为用户签发的登录票据
1. TGC：TGT存入Session后的唯一标识
1. ST：CAS为用户签发的访问某个Service的票据




## OAuth 2.0

### 概述
* 允许用户授权第三方网站访问他们存储在另外的服务提供者上的信息
* 一种授权机制：数据的所有者告诉系统，同意授权第三方应用进入系统，获取数据
* 使用令牌（Token）代替密码


### Token
* 令牌是短期的，到期会自动失效
* 令牌可以被数据所有者撤销，会立即失效
* 令牌有权限范围


### 授权模式
* 授权码：客户端换取授权码，客户端使用授权码换token，客户端使用token访问资源
* 隐藏式：客户端让用户登录授权服务器换token，客户端使用token访问资源
* 用户名密码式：用户在客户端提交账号密码换token，客户端使用token访问资源
* 客户端：客户端使用自己的标识换token，客户端使用token访问资源


#### 如何选择
![](http://picbed.cc12703.com/20221112150052.png)



### 授权码模式

#### 概述
* 第三方应用先申请一个授权码，然后再用该码获取令牌。


#### 角色
* 用户
* 客户端
* 授权服务器
* 资源服务器

#### 流程

* 客户端登录
![](http://picbed.cc12703.com/20221112144010.png)


* 服务器获取令牌
![](http://picbed.cc12703.com/20221112144648.png)


#### 优点
* 安全性最高：授权码通过前端传送，令牌则是储存在后端